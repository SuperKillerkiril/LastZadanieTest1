@page "/auth"
@using UrbanMuse.DataBase
@using UrbanMuse.Models
@inject ModelContext ef
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<div class="registered-custom-background">
    <div class="registered-container">
        <h3 class="registered-text">AUTHENTICATION</h3>
        <div class="registered-form">
            <input class="registered-form-input" type="text" @bind="_client.Email" placeholder="Email"/>
            <input class="registered-form-input" type="password" @bind="_client.Password" placeholder="Password"/>
            <button class="registered-form-button" @onclick="AuthUser">ACCEPT</button>
        </div>
        @Msg
    </div>
</div>

@code {
    Client _client = new Client();
    Client _authClient = new Client();
    private string Msg;

    public async Task AuthUser()
    {
        _authClient = ef.Clients.FirstOrDefault(c => c.Email == _client.Email);
        try
        {
            if (_authClient != null && _authClient.Password == _client.Password)
            {
                Msg = "You have successfully logged in";
                await Task.Delay(2000);
                NavigationManager.NavigateTo("");
            }
            else
            {
                Msg = "incorrect email or password";
            }
        }
        catch (Exception e)
        {
            Msg = e.ToString();
        }
        
    }
}